<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        <link rel="canonical" href="http://skoczen.github.io/will/deploy/">
        <link rel="shortcut icon" href="../img/favicon.ico">

        <title>Deploy</title>

        <link href="../css/bootstrap-custom.min.css" rel="stylesheet">
        <link href="../css/font-awesome-4.0.3.css" rel="stylesheet">
        <link href="../css/prettify-1.0.css" rel="stylesheet">
        <link href="../css/base.css" rel="stylesheet">
        <link href="../css/style.css" rel="stylesheet">

        <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->
        
    </head>

    <body>

        <div class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container">

        <!-- Collapsed navigation -->
        <div class="navbar-header">
            <!-- Expander button -->
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>

            <!-- Main title -->
            <a class="navbar-brand" href="..">Will</a>
        </div>

        <!-- Expanded navigation -->
        <div class="navbar-collapse collapse">
            <!-- Main navigation -->
            <ul class="nav navbar-nav">
            
            
                <li >
                    <a href="..">Get Started</a>
                </li>
            
            
            
                <li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">Teach Your Will <b class="caret"></b></a>
                    <ul class="dropdown-menu">
                    
                        <li >
                            <a href="../plugins/basics/">The Basics</a>
                        </li>
                    
                        <li >
                            <a href="../plugins/notice/">What Will Can Notice</a>
                        </li>
                    
                        <li >
                            <a href="../plugins/reply/">How Will Can Respond</a>
                        </li>
                    
                        <li >
                            <a href="../plugins/create/">Creating and Organizing Plugins</a>
                        </li>
                    
                        <li >
                            <a href="../plugins/builtins/">Plugin Builtins</a>
                        </li>
                    
                        <li >
                            <a href="../plugins/bundled/">Bundled Plugins</a>
                        </li>
                    
                    </ul>
                </li>
            
            
            
                <li >
                    <a href="../config/">Configure</a>
                </li>
            
            
            
                <li class="active">
                    <a href="./">Deploy</a>
                </li>
            
            
            
                <li >
                    <a href="../improve/">Improve</a>
                </li>
            
            
            
                <li >
                    <a href="../roadmap/">Roadmap</a>
                </li>
            
            
            </ul>

            <!-- Search, Navigation and Repo links -->
            <ul class="nav navbar-nav navbar-right">
                
                <li >
                    <a rel="next" href="../config/">
                        <i class="fa fa-arrow-left"></i> Previous
                    </a>
                </li>
                <li >
                    <a rel="prev" href="../improve/">
                        Next <i class="fa fa-arrow-right"></i>
                    </a>
                </li>
                
                <li>
                    <a href="https://github.com/skoczen/will/">
                        
                            <i class="fa fa-github"></i>
                        
                        GitHub
                    </a>
                </li>
                
            </ul>
        </div>
    </div>
</div>

        <div class="container">
            <div class="col-md-3"><div class="bs-sidebar hidden-print affix well" role="complementary">
    <ul class="nav bs-sidenav">
    
        <li class="main active"><a href="#deploying-your-will">Deploying your Will</a></li>
        
            <li><a href="#deploy-on-heroku">Deploy on Heroku</a></li>
        
            <li><a href="#depoly-in-docker">Depoly in Docker</a></li>
        
            <li><a href="#deploy-everywhere-else">Deploy Everywhere Else</a></li>
        
            <li><a href="#storage-backends">Storage Backends</a></li>
        
            <li><a href="#best-practices">Best Practices</a></li>
        
    
    </ul>
</div></div>
            <div class="col-md-9" role="main">

<h1 id="deploying-your-will">Deploying your Will</h1>
<p>Will's happy to run on your machine all day, every day.  But he really shines out in production where he can run independently of anything you do with your local machine.  Here are some best practices for deploying will.</p>
<h2 id="deploy-on-heroku">Deploy on Heroku</h2>
<p>Heroku is our recommended platform for deployment because it's simple, easy, and free. That's a tough combination to beat.  You're in no way locked in to running will on heroku, though - run him wherever you want!</p>
<h4 id="step-1-set-up-your-heroku-app-and-a-redis-addon">Step 1: Set up your heroku app, and a redis addon.</h4>
<p>Assuming you have the <a href="https://toolbelt.heroku.com/">heroku toolbelt</a> installed and all set up, it's as easy as this:</p>
<pre><code class="bash">heroku create our-will-name
heroku addons:add rediscloud
</code></pre>

<p>A note on rediscloud: you can also use redistogo, openredis, or anyone else.  We use rediscloud and like them.</p>
<h4 id="step-2-add-all-the-needed-environment-variables">Step 2: Add all the needed environment variables:</h4>
<p>You'll want to take all the variables that live in your virtualenv's <code>postactivate</code> file that feed into your will environment, and provide them to your heroku app.</p>
<p>At minimum, that's</p>
<pre><code class="bash">heroku config:set \
WILL_PUBLIC_URL=&quot;http://our-will-name.herokuapp.com&quot; \
WILL_USERNAME='12345_123456@chat.hipchat.com' \
WILL_PASSWORD='asj2498q89dsf89a8df' \
WILL_V2_TOKEN='asdfjl234jklajfa3azfasj3afa3jlkjiau' \
</code></pre>

<p>If you have more than 30 chat rooms, you must also set the V1 token to avoid hipchat rate limits:</p>
<pre><code class="bash">heroku config:set WILL_V1_TOKEN='kjadfj89a34878adf78789a4fae3'
</code></pre>

<p>Finally, for will's schedule to be correct, you need to set him to the time zone you want:</p>
<pre><code class="bash">heroku config:set TZ=&quot;America/Los_Angeles&quot;
</code></pre>

<p><strong>Note:</strong> You don't have to worry about setting the <code>REDIS_URL</code> or <code>HTTPSERVER_PORT</code>.  Will auto-detects those and takes care of it.</p>
<h4 id="step-3-deploy">Step 3: Deploy!</h4>
<p>You're all set to deploy your will. Ready? Go!</p>
<pre><code class="bash">git push heroku
</code></pre>

<p>You app is now up on heroku.  Finally, turn it on!</p>
<p><code>heroku scale web=1</code></p>
<p>That should be it - head over to <a href="http://our-will-name.herokuapp.com">http://our-will-name.herokuapp.com</a>, and you should see will's smiling face.</p>
<p>If so, pop into chat, and give a:</p>
<p><img alt="Hi, Hello, username!" src="../img/hi_hello.gif" /></p>
<h4 id="deploying-future-updates">Deploying future updates</h4>
<p>Just commit your updates, then</p>
<pre><code class="bash">git push heroku
</code></pre>

<p>Simple.  For best-practices, see our continuous deployment recommendations below.</p>
<h2 id="depoly-in-docker">Depoly in Docker</h2>
<p>Will is packaged with a Dockerfile and docker-compose files to allow deploying in a container with redis. </p>
<h3 id="pre-requisites">Pre-requisites</h3>
<p>You should have docker already installed; additionally, the instructions require docker-compose.  If you're not using docker-compose, you must start the image via the docker command with the correct arguments.</p>
<h3 id="step-1-configure-your-containers-environment-variables">Step 1: Configure your container's environment variables</h3>
<p>In Will's docker directory, update the default.env file with your environment's settings.  At a minimum, this should contain:</p>
<pre><code class="bash">WILL_USERNAME
WILL_PASSWORD
WILL_V2_TOKEN
</code></pre>

<p>Note, we've pre-defined the redis url and the HTTP Server port; if you update these values, make sure you update the docker-compose file accordingly. </p>
<h3 id="step-2-deploy-your-plugins-and-templates">Step 2: Deploy your plugins and templates</h3>
<p>If you have any custom templates, create directories for your plugins and templates, and load your plugins and templates they'll be mounted when the container starts up giving your contanerized bot access to your templates.</p>
<pre><code class="bash">mkdir ./plugins ./templates
</code></pre>

<h3 id="step-3-build-will">Step 3: Build will.</h3>
<p>Run build your docker image locally.</p>
<pre><code class="bash">docker-compose build 
</code></pre>

<h3 id="step-4-start-the-container">Step 4: Start the container</h3>
<p>Start your image from docker-compose using:</p>
<pre><code class="bash">docker-compose up 
</code></pre>

<p>or to run the container in the background,</p>
<pre><code class="bash">docker-compose up -d
</code></pre>

<h2 id="deploy-everywhere-else">Deploy Everywhere Else</h2>
<h4 id="will-is-just-python">Will is Just Python</h4>
<p>That says it all. Will is just python, and you can deploy him <em>anywhere</em> you have python, an open port, and access to redis.</p>
<p>In your chosen deploy environment and setup, you'll want to do a couple things:</p>
<h4 id="replicate-your-environment-settings">Replicate your environment settings</h4>
<p>At minimum, that's:</p>
<pre><code class="bash">export WILL_PUBLIC_URL=&quot;http://our-will-name.herokuapp.com&quot;
export WILL_USERNAME='12345_123456@chat.hipchat.com'
export WILL_PASSWORD='asj2498q89dsf89a8df'
export WILL_V2_TOKEN='asdfjl234jklajfa3azfasj3afa3jlkjiau'
export WILL_REDIS_URL='redis://some-domain.com/7/'
export WILL_HTTPSERVER_PORT='80'
</code></pre>

<p>If you have more than 30 chat rooms, you must also set the V1 token to avoid hipchat rate limits:</p>
<pre><code class="bash">export WILL_V1_TOKEN='kjadfj89a34878adf78789a4fae3'
</code></pre>

<p>You'll also need to set any environment variables for your plugins.</p>
<h4 id="call-run_will-with-something-that-handles-restarts-and-crashes">Call run_will with something that handles restarts and crashes.</h4>
<p>The command to kick off will is just:</p>
<pre><code>python run_will.py
</code></pre>

<p>You can run that with whatever supervisory process you'd like. Will's very, very stable, but having something that handles crashes is still a pretty good idea.</p>
<h4 id="alternate-approach">Alternate approach</h4>
<p>Ah, you say, but I have this crazy python-twisted-zope-node monolith that self-repairs mars and can do everything. Why do I need the shell at all?</p>
<p>Answer, crazy monolith mars person: you don't.  Will is Just Python.</p>
<pre><code class="python">from will.main import WillBot

bot = WillBot()
bot.bootstrap()
</code></pre>

<p>and you're good.</p>
<h2 id="storage-backends">Storage Backends</h2>
<p>Will's default storage backend is Redis, but he supports some others if you can't run Redis.</p>
<p>To change the backend, just set <code>STORAGE_BACKEND</code> in <code>config.py</code> and then supply any other needed settings for the new storage backend.  The currently supported backends are:</p>
<ul>
<li><code>redis</code> - The default Redis backend</li>
<li><code>couchbase</code> - A Couchbase backend</li>
<li><code>file</code> - Keeps the settings as files on a local filesystem</li>
</ul>
<h4 id="couchbase">Couchbase</h4>
<p>Couchbase requries you set <code>COUCHBASE_URL</code> in your config.</p>
<p>You are also required to have the python Couchbase client (and thus, libcouchbase) installed.  If you are installing for development you can use <code>pip install -r requirements.couchbase.txt</code> to pull in the Couchbase client.  See <a href="https://github.com/couchbase/couchbase-python-client">the Python Couchbase client repo</a> for more info.</p>
<p>Examples:</p>
<ul>
<li><code>COUCHBASE_URL='couchbase:///bucket'</code></li>
<li><code>COUCHBASE_URL='couchbase://hostname/bucket'</code></li>
<li><code>COUCHBASE_URL='couchbase://host1,host2/bucket'</code></li>
<li><code>COUCHBASE_URL='couchbase://hostname/bucket?password=123abc&amp;timeout=5'</code></li>
</ul>
<h4 id="file">File</h4>
<p>File requires you set <code>FILE_DIR</code> in your config to point to an empty directory.</p>
<p>Examples:</p>
<ul>
<li><code>FILE_DIR='/var/run/will/settings/'</code></li>
<li><code>FILE_DIR='~will/settings/'</code></li>
</ul>
<h2 id="best-practices">Best Practices</h2>
<p>In this section, we describe how we deploy and host will, in the hopes that others come forward and share what's working for them, too.  The more good practices, the better.</p>
<h4 id="our-stack">Our Stack</h4>
<p>We host on heroku, using rediscloud for redis, mailgun for email, and things have been peachy.  We deploy via CD using CircleCI. Details on that below.</p>
<h4 id="use-continuous-deployment">Use Continuous Deployment</h4>
<p>Our stack is set up so that any pushes on will's master branch have tests run on <a href="http://circleci.com">CircleCI</a>, and if they pass, a new version is deployed to heroku immediately.  This has been delightful. Even though will has very, very minimal tests, we generally catch if things are horribly broken, and it's meant that adding new functionality to will takes minutes, sometimes seconds of developer time.</p>
<p>Continuous Deployment has dramatically changed how we build and use will - instead of talking about "what if will did...", generally, people just implement it, push it, and play with it for real.  It's been a great place to be.  It might be for you too.</p>
<p>That's it in getting your will up and running!   But maybe you're one of those people who wants to pitch in and make will even better. Awesome. Learn <a href="../improve/">how to improve will</a>.</p></div>
        </div>

        

        <script src="https://code.jquery.com/jquery-1.10.2.min.js"></script>
        <script src="../js/bootstrap-3.0.3.min.js"></script>
        <script src="../js/prettify-1.0.min.js"></script>
        <script src="../js/base.js"></script>
    </body>
</html>